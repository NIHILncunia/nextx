# nextx - English Documentation

A simple and opinionated CLI for scaffolding Next.js (App Router) projects.

This tool helps you quickly generate boilerplate code for pages, API routes, and data entities, following a consistent project structure and conventions. It provides various features including file overwrite protection, custom component name specification, and flexible path generation options.

## Installation

To use `nextx` globally, install it via npm or pnpm:

```bash
npm install -g @NIHILncunia/nextx
# or
pnpm add -g @NIHILncunia/nextx
```

**Note**: `nextx` automatically finds Next.js projects (`next.config.js` location) in the current directory, parent directories, or pnpm monorepo workspace. You can use configuration files to specify specific paths.

### Project Initialization

Before using `nextx`, you need to initialize your project first:

```bash
nextx init
```

This command performs the following tasks:

- Creates `nextx.config.json` configuration file
- Generates necessary utility functions (`cn`, `Api` class, etc.)
- Creates common entity files
- Automatically installs required dependency packages

---

## Configuration

While `nextx` works out-of-the-box with no configuration, you can create a configuration file to customize its behavior for your project structure.

### Configuration File

You can override the default paths for generated files by creating a `nextx.config.ts`, `nextx.config.js`, or `nextx.config.json` file in your project root. The CLI will search for them in that order.

**`nextx.config.ts` Example (Recommended):**

```typescript
// nextx.config.ts
export default {
  lang: "en", // 'ko' | 'en' | 'jp'
  useSrc: false, // Whether to use src directory
  componentInRoute: true, // Create components inside route
  componentCategory: false, // Categorize shared components by group
  aliases: {
    app: "app",
    entities: "app/_entities",
    components: "components", // Shared components path
    libs: "app/_libs",
  },
};
```

**`nextx.config.json` Example:**

```json
{
  "lang": "en",
  "useSrc": false,
  "componentInRoute": true,
  "componentCategory": false,
  "aliases": {
    "app": "app",
    "entities": "app/_entities",
    "components": "app/_components",
    "libs": "app/_libs"
  }
}
```

**Options:**

- `lang`: Sets the CLI message language. (Supports `ko`, `en`, `jp`) Default: `"ko"`.
- `useSrc`: Whether to use `src` directory. Default: `false`.
- `componentInRoute`: Whether to create components inside the route directory (`_components`). Default: `true`.
- `componentCategory`: If `componentInRoute` is false, this option categorizes shared components by their group name. Default: `false`.
- `aliases.app`: Specifies the path to the Next.js `app` directory. Default: `"app"`.
- `aliases.entities`: Specifies the root path for files generated by the `entity` command. Default: `"app/_entities"`.
- `aliases.components`: Specifies the path to shared components directory. Default: `"app/_components"`.
- `aliases.libs`: Specifies the path to library files. Default: `"app/_libs"`.

### Monorepo Support

- **Auto-detection**: When no configuration file exists, `nextx` automatically detects pnpm monorepo structure by checking for the presence of `pnpm-workspace.yaml` files.
- **Auto path discovery**: When a monorepo environment is detected, `nextx` traverses package paths defined in `pnpm-workspace.yaml` (`apps/*`, `packages/*`, etc.) to automatically find Next.js projects with `next.config.js`.
- Therefore, regardless of where you run the `nextx` command in a monorepo (root directory or sub-package directory), the CLI will generate files in the correct Next.js project.

---

## Usage

### `nextx init`

Initializes the project and generates necessary configuration files and utility functions.

**Syntax**

```bash
nextx init [options]
```

- `[options]`:
  - `-f, --force`: Overwrites existing configuration files

**Example**

```bash
# Initialize project
$ nextx init

# Overwrite existing configuration files
$ nextx init --force
```

**Generated Files**

```
app/
â”œâ”€â”€ _libs/
â”‚   â”œâ”€â”€ cn.ts
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â””â”€â”€ axios.tools.ts
â”‚   â””â”€â”€ index.ts
â””â”€â”€ _entities/
    â””â”€â”€ common/
        â”œâ”€â”€ common.types.ts
        â”œâ”€â”€ common.keys.ts
        â”œâ”€â”€ common.store.ts
        â”œâ”€â”€ process.d.ts
        â”œâ”€â”€ react-query.d.ts
        â””â”€â”€ hooks/
            â”œâ”€â”€ index.ts
            â”œâ”€â”€ use-done.ts
            â”œâ”€â”€ use-loading.ts
            â””â”€â”€ api/
                â”œâ”€â”€ use-get.ts
                â”œâ”€â”€ use-post.ts
                â”œâ”€â”€ use-patch.ts
                â”œâ”€â”€ use-put.ts
                â””â”€â”€ use-delete.ts
```

**Automatically Installed Packages**

- `@tanstack/react-query`
- `@lukemorales/query-key-factory`
- `axios`
- `class-variance-authority`
- `clsx`
- `tailwind-merge`
- `@tanstack/react-query-devtools` (devDependencies)

### `nextx page`

Generates a new page route and its related components.

**Syntax**

```bash
nextx page <group> <paths...> [options]
```

- `<group>`: The route group for the page. A directory will be created as `app/(<group>)/...`.
- `<paths...>`: The path(s) for the page to be created. You can specify multiple paths, and dynamic routes like `posts/[id]` are supported.
- `[options]`:
  - `-a, --all`: Also creates pages for all parent directories in the path.
  - `-r, --root`: Also creates a page at the group's root path.
  - `-f, --force`: Forces overwriting of existing files without confirmation.
  - `-c, --component <names...>`: Specifies custom component names to be applied to the generated paths in order.

**Example**

```bash
# Create a dynamic detail page in the 'posts' group
$ nextx page posts posts/[id]

# Create pages for intermediate paths only (excluding group root)
$ nextx page common test/new --all

# Create pages at group root and specified path
$ nextx page common test/new --root

# Create pages for all paths (original --all behavior)
$ nextx page common test/new --all --root

# Specify custom component names
$ nextx page posts list detail --component PostList PostDetail

# Force overwrite existing files
$ nextx page posts list --force
```

**Result**

```
app/
â””â”€â”€ (posts)/
    â””â”€â”€ posts/
        â””â”€â”€ [id]/
            â”œâ”€â”€ _components/
            â”‚   â””â”€â”€ PostsDetail.tsx
            â””â”€â”€ page.tsx
```

**Different results based on configuration:**

```typescript
// nextx.config.ts
export default {
  useSrc: true,
  componentInRoute: false,
  componentCategory: true,
  aliases: {
    app: "app",
    components: "components",
  },
};
```

When running `nextx page posts list` with the above configuration:

```
src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ (posts)/
â”‚       â””â”€â”€ list/
â”‚           â””â”€â”€ page.tsx
â””â”€â”€ components/
    â””â”€â”€ posts/
        â””â”€â”€ PostList.tsx
```

**Option Behavior Comparison**

Using `nextx page common test/new` as a reference, here's how options affect the behavior:

| Command                     | Generated Paths                       |
| :-------------------------- | :------------------------------------ |
| `... test/new`              | `test/new`                            |
| `... test/new --all`        | `test`, `test/new`                    |
| `... test/new --root`       | `''` (group root), `test/new`         |
| `... test/new --all --root` | `''` (group root), `test`, `test/new` |

**File Overwrite Protection**

By default, if a file already exists at the target location, the CLI will prompt for confirmation before overwriting:

```bash
$ nextx page posts list
# When file already exists:
The file 'app/(posts)/list/page.tsx' already exists. Do you want to overwrite it? (y/N)
```

- Enter `y` to overwrite the file.
- Enter `N` or press Enter to skip file creation.
- Use the `--force` option to overwrite without confirmation.

**CLI Output Format**

All commands follow a consistent output format:

```bash
ðŸš€ Starting to create a new page...

  - Project path: /path/to/project
  - App directory: app
  - Group: posts
  - Path: list, detail

âœ… PostList.tsx created successfully. (app/(posts)/list/_components/PostList.tsx)
âœ… page.tsx created successfully. (app/(posts)/list/page.tsx)
âœ… PostDetail.tsx created successfully. (app/(posts)/detail/_components/PostDetail.tsx)
âœ… page.tsx created successfully. (app/(posts)/detail/page.tsx)

ðŸŽ‰ All tasks completed successfully!
```

### `nextx api`

Generates a new API route handler (`route.ts`).

**Syntax**

```bash
nextx api <category> [paths...] [options]
```

- `<category>`: The logical category for the API. A directory will be created as `app/api/<category>/...`.
- `[paths...]`: The API endpoint path(s) to create. If omitted, a route is created at the category root.
- `[options]`:
  - `-a, --all`: Also creates API routes for all parent directories in the path.

**Example**

```bash
# Create a login API in the 'auth' category
$ nextx api auth login
```

**Result**

```
app/
â””â”€â”€ api/
    â””â”€â”€ auth/
        â””â”€â”€ login/
            â””â”€â”€ route.ts
```

### `nextx entity`

Generates files for data state management (Query keys, Zustand store, types, etc.).

**Syntax**

```bash
nextx entity <name>
```

- `<name>`: The name of the entity to create (e.g., `user-profile`, `post`).
- Using `common` as the name will generate shared data management logic (custom hooks, etc.) for use across multiple entities.

**Example 1: Create a `user-profile` entity**

```bash
$ nextx entity user-profile
```

**Result** (Created in the path specified by `aliases.entities` in `nextx.config.json`)

```
app/_entities/
â””â”€â”€ user-profile/
    â”œâ”€â”€ hooks/
    â”‚   â””â”€â”€ index.ts
    â”œâ”€â”€ user-profile.keys.ts
    â”œâ”€â”€ user-profile.store.ts
    â””â”€â”€ user-profile.types.ts
```

**Example 2: Generate common entity files**

```bash
$ nextx entity common
```

**Result**

```
app/_entities/
â””â”€â”€ common/
    â”œâ”€â”€ common.keys.ts
    â”œâ”€â”€ common.store.ts
    â”œâ”€â”€ common.types.ts
    â”œâ”€â”€ process.d.ts
    â”œâ”€â”€ react-query.d.ts
    â””â”€â”€ hooks/
        â”œâ”€â”€ index.ts
        â”œâ”€â”€ use-done.ts
        â”œâ”€â”€ use-loading.ts
        â””â”€â”€ api/
            â”œâ”€â”€ use-delete.ts
            â”œâ”€â”€ use-get.ts
            â”œâ”€â”€ use-patch.ts
            â”œâ”€â”€ use-post.ts
            â””â”€â”€ use-put.ts
```

### `nextx config`

Checks or modifies the `nextx` configuration.

**Syntax**

```bash
nextx config <get|set> <key> [value]
```

- `get <key>`: Checks the current value of a setting.
- `set <key> <value>`: Changes the value of a setting. This command can only modify `nextx.config.json` files.

Currently, the only supported `<key>` is `lang`.

**Examples**

```bash
# Check the currently configured language
$ nextx config get lang
lang: ko

# Change the language to English
$ nextx config set lang en
âœ… Configuration changed successfully: lang = en
```

---

## License

MIT
